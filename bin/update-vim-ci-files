#!/bin/bash

commit_file()
{
  cat >"$1"
  git add "$1"
}

if [ -f Gemfile ]
then
  verb='Update'
else
  verb='Add'
fi

commit_file Gemfile <<'END'
source 'https://rubygems.org'

gem 'vim-flavor', '~> 3.0'
END
git commit -am "$verb a Gemfile for development dependencies"

commit_file Rakefile <<'END'
#!/usr/bin/env rake

task :ci => [:dump, :test]

task :dump do
  sh 'vim --version'
end

task :test do
  sh 'bundle exec vim-flavor test'
end
END
git commit -am "$verb a Rakefile for routine works"

commit_file Flavorfile <<'END'
# No dependencies.
END
git commit -am "$verb a Flavorfile for runtime dependencies"

commit_file .travis.yml <<'END'
language: vim
cache:
directories:
  - $HOME/.rvm
  - $HOME/.vvm
before_install:
- curl https://raw.githubusercontent.com/kana/vim-version-manager/master/bin/vvm | python - setup; true
- source ~/.vvm/etc/login
- vvm update_itself
- vvm use vimorg--v8.0.1529 --install --with-features=huge
-
- rvm use 2.5.0 --install --binary --fuzzy
script: rake ci
END
git commit -am "$verb Configure Travis CI to use vim-flavor"

commit_file .gitignore <<'END'
.vim-flavor
Gemfile.lock
Flavorfile.lock
END
git commit -am "$verb a .gitignore for intermediate stuffs"
